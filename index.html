<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DINO Game</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            dinoPrimary: '#0FBA68',
            dinoSecondary: '#FFCA28',
            dinoBg: '#1C1C2E',
            dinoCard: '#2A2A40',
            dinoModalBg: '#272743'
          }
        }
      }
    }
  </script>
  <style>
    @keyframes cardPulse {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 202, 40, 0.4); }
      50% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(255, 202, 40, 0); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 202, 40, 0); }
    }

    @keyframes rewardAnimation {
      0% { transform: scale(0); opacity: 0; }
      50% { transform: scale(1.1); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }

    body {
      font-family: 'Rubik', sans-serif;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      user-select: none;
    }
    .dino-box {
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
      transition: all 0.3s ease;
      background: linear-gradient(145deg, #2A2A40, #1f1f32);
      border-radius: 18px;
    }
    .dino-box:hover {
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
    }
    .nav-btn {
      transition: all 0.3s ease;
      border-top: 3px solid transparent;
    }
    .nav-btn.active {
      border-top: 3px solid #FFCA28;
      color: #FFCA28;
    }
    .tab-btn {
      transition: all 0.3s ease;
    }
    .tab-btn.active {
      background-color: #0FBA68;
      color: white;
    }
    .investment-card {
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(15, 186, 104, 0.7); }
      70% { box-shadow: 0 0 0 8px rgba(15, 186, 104, 0); }
      100% { box-shadow: 0 0 0 0 rgba(15, 186, 104, 0); }
    }
    .box-shake {
      animation: shake 0.5s;
    }
    @keyframes shake {
      0% { transform: translate(1px, 1px) rotate(0deg); }
      10% { transform: translate(-1px, -2px) rotate(-1deg); }
      20% { transform: translate(-3px, 0px) rotate(1deg); }
      30% { transform: translate(3px, 2px) rotate(0deg); }
      40% { transform: translate(1px, -1px) rotate(1deg); }
      50% { transform: translate(-1px, 2px) rotate(-1deg); }
      60% { transform: translate(-3px, 1px) rotate(0deg); }
      70% { transform: translate(3px, 1px) rotate(-1deg); }
      80% { transform: translate(-1px, -1px) rotate(1deg); }
      90% { transform: translate(1px, 2px) rotate(0deg); }
      100% { transform: translate(1px, -2px) rotate(-1deg); }
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }
    .dino-modal {
      width: 90%;
      max-width: 500px;
      padding: 25px;
      border-radius: 20px;
      background: linear-gradient(to bottom, #3a3a5d, #2c2c4a);
      position: relative;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }
    .modal-content {
      max-height: 80vh;
      overflow-y: auto;
      padding-right: 10px;
    }
    .chest-container {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 250px;
      margin: 20px 0;
      perspective: 800px;
    }
    .chest {
      width: 180px;
      height: 140px;
      position: relative;
      transform-style: preserve-3d;
      cursor: pointer;
      transition: transform 0.5s ease;
    }
    .chest-top {
      position: absolute;
      top: 0;
      width: 180px;
      height: 40px;
      background-color: #FFCA28;
      transform-origin: bottom center;
      transform: translateZ(0px) rotateX(0deg);
      box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
      border-radius: 5px 5px 0 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: #b58700;
      font-weight: bold;
    }
    .chest-body {
      position: absolute;
      top: 40px;
      width: 180px;
      height: 100px;
      background-color: #E6B800;
      border-radius: 0 0 5px 5px;
      box-shadow: inset 0 -5px 15px rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      color: #b58700;
      font-weight: bold;
    }
    .chest.open .chest-top {
      transform: translateZ(50px) rotateX(-100deg);
    }
    .reward-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin: 20px 0;
    }
    .reward-card {
      background: linear-gradient(135deg, #2A2A40, #1C1C2E);
      border-radius: 12px;
      padding: 15px;
      text-align: center;
      border: 2px solid #444;
      cursor: pointer;
      transition: all 0.3s;
    }
    .reward-card:hover {
      transform: translateY(-5px);
      border-color: #FFCA28;
    }
    .reward-card.selected {
      animation: cardPulse 0.8s ease-in-out;
      border-color: #FFCA28;
      background: linear-gradient(135deg, #3c3c5c, #2c2c4a);
    }
    .notify-modal {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(145deg, #2A2A40, #1f1f32);
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      padding: 15px;
      z-index: 999;
      animation: rewardAnimation 0.5s;
      border-left: 4px solid #0FBA68;
    }
    .difficulty-star {
      font-size: 0.8rem;
      color: #FFCA28;
      margin-left: 5px;
    }
    .card-highlight {
      animation: rewardAnimation 0.5s ease-out;
    }

    @keyframes highlightButton {
  0% { box-shadow: 0 0 0 0 rgba(15, 186, 104, 0.7); }
  50% { box-shadow: 0 0 0 8px rgba(15, 186, 104, 0); }
  100% { box-shadow: 0 0 0 0 rgba(15, 186, 104, 0); }
}
.animate-highlightButton {
  animation: highlightButton 1.5s infinite;
}
    .quest-completed {
  opacity: 0.5;
  filter: brightness(0.7);
  transition: opacity 0.3s ease, filter 0.3s ease;
}
    @keyframes coinFloat {
  0% { transform: translateY(0) scale(1); opacity: 1; }
  100% { transform: translateY(-50px) scale(0.5); opacity: 0; }
}

.coin-animation {
  position: absolute;
  pointer-events: none;
  animation: coinFloat 0.8s ease-out forwards;
  font-size: 1.2rem;
  color: #FFCA28;
  font-weight: bold;
  z-index: 10;
}
    #click-area {
  position: relative;
  overflow: hidden;
}
    .wallet-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(0, 186, 104, 0.3);
}
.news-card {
  transition: all 0.3s ease;
}
.news-card:hover {
  background: linear-gradient(145deg, #3c3c5c, #2c2c4a);
}
    .purchase-history {
  margin-top: 10px;
}
  </style>
</head>
<body class="bg-dinoBg text-gray-100 min-h-screen pb-20">
  <div class="max-w-md mx-auto px-4 pt-6 pb-20">
    <div class="dino-box p-5 mb-6 relative">
      <div class="flex justify-between items-center">
        <div>
          <p class="text-3xl font-bold mt-1 text-dinoSecondary"><span id="balance">0</span></p>
          <p class="text-gray-400 text-sm">DINO</p>
        </div>
        <div>
          <p class="text-xl font-bold mt-1 text-dinoPrimary"><span id="dps">0</span></p>
          <p class="text-gray-400 text-sm">DINO/—Å–µ–∫</p>
        </div>
        <div class="bg-gray-800 rounded-full h-12 w-12 flex items-center justify-center">
          <i class="fas fa-dragon text-xl text-dinoPrimary"></i>
        </div>
      </div>
    </div>

    <div id="content"></div>

    <div class="fixed bottom-0 left-0 w-full bg-dinoCard py-2 px-4 flex justify-around border-t border-gray-700 z-10">
      <button class="nav-btn active flex flex-col items-center w-1/5" data-tab="clicker">
        <i class="fas fa-hand-pointer text-xl mb-1"></i>
        <span class="text-xs">–ö–ª–∏–∫–µ—Ä</span>
      </button>
      <button class="nav-btn flex flex-col items-center w-1/5" data-tab="business">
        <i class="fas fa-building text-xl mb-1"></i>
        <span class="text-xs">–ë–∏–∑–Ω–µ—Å</span>
      </button>
      <button class="nav-btn flex flex-col items-center w-1/5" data-tab="investments">
        <i class="fas fa-chart-line text-xl mb-1"></i>
        <span class="text-xs">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</span>
      </button>
      <button class="nav-btn flex flex-col items-center w-1/5" data-tab="quests">
        <i class="fas fa-tasks text-xl mb-1"></i>
        <span class="text-xs">–ö–≤–µ—Å—Ç—ã</span>
      </button>
      <button class="nav-btn flex flex-col items-center w-1/5" data-tab="profile">
        <i class="fas fa-user text-xl mb-1"></i>
        <span class="text-xs">–ü—Ä–æ—Ñ–∏–ª—å</span>
      </button>
    </div>
  </div>

  <div id="modal-container" class="hidden"></div>
  <div id="notification-container"></div>

  <script>
// –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
const state = {
  balance: 100,
  perClick: 2.5,
  dps: 0,
  clickUpgradeCost: 5000,
 businesses: [
  { id: 1, name: "–î–∏–Ω–æ–∑–∞–≤—Ä–∏–∫ –ë—É—Ä–≥–µ—Ä", level: 0, baseIncome: 0.1, cost: 50, owned: 0 },
  { id: 2, name: "DINO –§–∏—à–∏–Ω–≥", level: 0, baseIncome: 0.5, cost: 100, owned: 0 },
  { id: 3, name: "–î–∏–Ω–æ–∑–∞–≤—Ä–∏–π –ü–∏—Ç–æ–º–Ω–∏–∫", level: 0, baseIncome: 1, cost: 250, owned: 0 },
  { id: 4, name: "DINO –†–µ–º–æ–Ω—Ç", level: 0, baseIncome: 2, cost: 500, owned: 0 },
  { id: 5, name: "–ú–æ–Ω–æ–î–∏–Ω–æ –≠–∫—Å–ø—Ä–µ—Å—Å", level: 0, baseIncome: 5, cost: 1000, owned: 0 },
  { id: 6, name: "–û—Ç–µ–ª—å –Æ—Ä—Å–∫–æ–≥–æ –ü–µ—Ä–∏–æ–¥–∞", level: 0, baseIncome: 10, cost: 2000, owned: 0 },
  { id: 7, name: "–ü–∞—Ä–∫ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏–π DINO", level: 0, baseIncome: 20, cost: 4000, owned: 0 },
  { id: 8, name: "DINO Research Labs", level: 0, baseIncome: 30, cost: 8000, owned: 0 },
  { id: 9, name: "–®–∞—Ö—Ç—ã –ú–µ–ª–æ–≤–æ–≥–æ –ü–µ—Ä–∏–æ–¥–∞", level: 0, baseIncome: 40, cost: 16000, owned: 0 },
  { id: 10, name: "DINO –ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –ü—Ä–æ–≥—Ä–∞–º–º–∞", level: 0, baseIncome: 50, cost: 32000, owned: 0 },
  { id: 11, name: "–î–∏–Ω–æ –ó–∞–≤–æ–¥ –†–æ–±–æ—Ç–æ–≤", level: 0, baseIncome: 60, cost: 64000, owned: 0 },
  { id: 12, name: "–î–∏–Ω–æ –§–∏–Ω–∞–Ω—Å—ã", level: 0, baseIncome: 70, cost: 128000, owned: 0 },
  { id: 13, name: "–ë–∞–Ω–∫ –Æ—Ä—Å–∫–æ–≥–æ –ü–µ—Ä–∏–æ–¥–∞", level: 0, baseIncome: 80, cost: 256000, owned: 0 },
  { id: 14, name: "DINO –ö—Ä–∏–ø—Ç–æ –≠–∫–æ—Å–∏—Å—Ç–µ–º–∞", level: 0, baseIncome: 90, cost: 512000, owned: 0 },
  { id: 15, name: "DINO –ú–∞—Ç—Ä–∏—Ü–∞ –í—Å–µ–ª–µ–Ω–Ω–æ–π", level: 0, baseIncome: 100, cost: 5000000, owned: 0 },
],
  investments: {
  realEstate: [
    { id: "–î–∏–Ω–æ –ü–µ—â–µ—Ä–∞", name: "–î–∏–Ω–æ –ü–µ—â–µ—Ä–∞", basePrice: 100000, price: 100000, change: 0, owned: 0 },
    { id: "–Æ—Ä—Å–∫–∏–µ –•–æ–ª–º—ã", name: "–Æ—Ä—Å–∫–∏–µ –•–æ–ª–º—ã", basePrice: 15000, price: 0, change: 0, owned: 0 },
    { id: 2, name: "–û—Å—Ç—Ä–æ–≤ –î–∏–Ω–æ", basePrice: 2000000, price: 2000000, change: 0, owned: 0 },
    { id: 3, name: "–î–∏–Ω–æ –ù–µ–±–æ—Å–∫—Ä–µ–±", basePrice: 1000000, price: 1000000, change: 0, owned: 0 },
    { id: 4, name: "–ü–µ–Ω—Ç—Ö–∞—É—Å –¢-–†–µ–∫—Å", basePrice: 5000000, price: 5000000, change: 0, owned: 0 },
    { id: 5, name: "–î–∏–Ω–æ –†–µ–∑–∏–¥–µ–Ω—Ü–∏—è", basePrice: 20000000, price: 20000000, change: 0, owned: 0 },
    { id: 6, name: "–Æ—Ä—Å–∫–∏–π –ó–∞–º–æ–∫", basePrice: 1000000, price: 10000000, change: 0, owned: 0 },
    { id: 7, name: "–ü–ª–∞–Ω–µ—Ç–∞ –î–∏–Ω–æ", basePrice: 5000000000, price: 5000000000, change: 0, owned: 0 },
    { id: 8, name: "–í—É–ª–∫–∞–Ω –†–∞–ø—Ç–æ—Ä–∞", basePrice: 100000000, price: 1000000000, change: 0, owned: 0 },
    { id: 9, name: "–°–∞–≤–∞–Ω–Ω–∞ –¢—Ä–∏—Ü–µ—Ä–∞—Ç–æ–ø—Å–∞", basePrice: 25000000000, price: 25000000000, change: 0, owned: 0 },
    { id: 10, name: "–ö–∞–Ω—å–æ–Ω –ë—Ä–æ–Ω—Ç–æ–∑–∞–≤—Ä–∞", basePrice: 5000000000, price: 5000000000, change: 0, owned: 0 },
    { id: 11, name: "–ú–µ—Ç–µ–æ—Ä–∏—Ç–Ω—ã–π –ö—Ä–∞—Ç–µ—Ä", basePrice: 10000000000, price: 10000000000, change: 0, owned: 0 },
    { id: 12, name: "–õ–∞–≥—É–Ω–∞ –ü—Ç–µ—Ä–æ–¥–∞–∫—Ç–∏–ª—è", basePrice: 25000000000, price: 25000000000, change: 0, owned: 0 },
    { id: 13, name: "–î–∏–Ω–æ –ú–µ—Ç—Ä–æ–ø–æ–ª–∏—Å", basePrice: 50000000000, price: 50000000000, change: 0, owned: 0 },
    { id: 14, name: "–û–∞–∑–∏—Å –°—Ç–µ–≥–æ–∑–∞–≤—Ä–∞", basePrice: 100000000000, price: 100000000000, change: 0, owned: 0 },
    { id: 15, name: "–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –ë–∞–∑–∞ –î–∏–Ω–æ", basePrice: 250000000000, price: 250000000000, change: 0, owned: 0 },
    { id: 16, name: "–ü–æ–¥–≤–æ–¥–Ω—ã–π –†–∏—Ñ –Æ—Ä—Å–∫–æ–≥–æ", basePrice: 500000000000, price: 500000000000, change: 0, owned: 0 },
    { id: 17, name: "–ì–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –£—Å–∞–¥—å–±–∞", basePrice: 1000000000000, price: 1000000000000, change: 0, owned: 0 }
  ],
  purchaseHistory: {
    realEstate: {},
    stocks: {},
    crypto: {}
  },
  stocks: [
    { id: 1, name: "DINO Inc.", basePrice: 50000, price: 50000, change: 0, owned: 0 },
    { id: 2, name: "–î–∏–Ω–æ –ö–æ—Ä–ø–æ—Ä–µ–π—à–Ω", basePrice: 200000, price: 200000, change: 0, owned: 0 },
    { id: 3, name: "–Æ—Ä—Å–∫–∞—è –°—Ç–∞–ª—å", basePrice: 1000000, price: 1000000, change: 0, owned: 0 },
    { id: 4, name: "–ü–∞–ª–µ–æ –¢–µ—Ö–Ω–æ–ª–æ–¥–∂–∏", basePrice: 5000000, price: 5000000, change: 0, owned: 0 },
    { id: 5, name: "–¢—Ä–∏—Ü–µ—Ä–∞—Ç–æ–ø—Å –ò–Ω–≤–µ—Å—Ç", basePrice: 20000000, price: 20000000, change: 0, owned: 0 },
    { id: 6, name: "–†–∞–ø—Ç–æ—Ä –ì—Ä—É–ø–ø", basePrice: 100000000, price: 100000000, change: 0, owned: 0 },
    { id: 7, name: "–ë—Ä–æ–Ω—Ç–æ–∑–∞–≤—Ä –§–∏–Ω–∞–Ω—Å", basePrice: 500000000, price: 500000000, change: 0, owned: 0 },
    { id: 8, name: "–°—Ç–µ–≥–æ–∑–∞–≤—Ä –•–æ–ª–¥–∏–Ω–≥", basePrice: 2000000000, price: 2000000000, change: 0, owned: 0 },
    { id: 9, name: "–í–µ–ª–æ—Ü–∏—Ä–∞—Ç–æ—Ä –¢—Ä–µ–π–¥", basePrice: 5000000000, price: 5000000000, change: 0, owned: 0 },
    { id: 10, name: "–ü—Ç–µ—Ä–æ–¥–∞–∫—Ç–∏–ª—å –ê—ç—Ä–æ", basePrice: 10000000000, price: 10000000000, change: 0, owned: 0 },
    { id: 11, name: "–ú–µ–∑–æ–∑–æ–π –≠–Ω–µ—Ä–¥–∂–∏", basePrice: 25000000000, price: 25000000000, change: 0, owned: 0 },
    { id: 12, name: "–ö—Ä–µ—Ç–æ –¢–µ—Ö–Ω–æ–ª–æ–¥–∂–∏", basePrice: 50000000000, price: 50000000000, change: 0, owned: 0 },
    { id: 13, name: "–ê–Ω–∫–∏–ª–æ–∑–∞–≤—Ä –ò–Ω–¥–∞—Å—Ç—Ä–∏–∑", basePrice: 100000000000, price: 100000000000, change: 0, owned: 0 },
    { id: 14, name: "–¢–∏—Ä–∞–Ω–Ω–æ–∑–∞–≤—Ä –ö–∞–ø–∏—Ç–∞–ª", basePrice: 250000000000, price: 250000000000, change: 0, owned: 0 },
    { id: 15, name: "–î–∏–Ω–æ –î–∏–Ω–∞–º–∏–∫—Å", basePrice: 500000000000, price: 500000000000, change: 0, owned: 0 },
    { id: 16, name: "–Æ—Ä—Å–∫–∏–π –í–µ–Ω—á—É—Ä", basePrice: 1000000000000, price: 1000000000000, change: 0, owned: 0 },
    { id: 17, name: "–ü–∞–ª–µ–æ –ü—Ä–æ–≥—Ä–µ—Å—Å", basePrice: 2500000000000, price: 2500000000000, change: 0, owned: 0 },
    { id: 18, name: "–ö–æ—Å–º–æ –î–∏–Ω–æ –ö–æ—Ä–ø", basePrice: 5000000000000, price: 5000000000000, change: 0, owned: 0 }
  ],
  crypto: [
    { id: 1, name: "Tironozavr Coin", basePrice: 1000, price: 1000, change: 0, owned: 0 },
    { id: 2, name: "Raptor Token", basePrice: 5000, price: 5000, change: 0, owned: 0 },
    { id: 3, name: "Tricera Coin", basePrice: 20000, price: 20000, change: 0, owned: 0 },
    { id: 4, name: "Stego Crypto", basePrice: 100000, price: 100000, change: 0, owned: 0 },
    { id: 5, name: "Bronto Token", basePrice: 500000, price: 500000, change: 0, owned: 0 },
    { id: 6, name: "Ptero Coin", basePrice: 2000000, price: 2000000, change: 0, owned: 0 },
    { id: 7, name: "Mesozoik", basePrice: 10000000, price: 10000000, change: 0, owned: 0 },
    { id: 8, name: "Cretaceous Cash", basePrice: 50000000, price: 50000000, change: 0, owned: 0 },
    { id: 9, name: "Jurassic Gem", basePrice: 200000000, price: 200000000, change: 0, owned: 0 },
    { id: 10, name: "Veloci Coin", basePrice: 1000000000, price: 1000000000, change: 0, owned: 0 },
    { id: 11, name: "Ankylosaur Asset", basePrice: 5000000000, price: 5000000000, change: 0, owned: 0 },
    { id: 12, name: "Mammoth Mint", basePrice: 20000000000, price: 20000000000, change: 0, owned: 0 },
    { id: 13, name: "Saurian Stake", basePrice: 100000000000, price: 100000000000, change: 0, owned: 0 },
    { id: 14, name: "Paleo Pulse", basePrice: 500000000000, price: 500000000000, change: 0, owned: 0 },
    { id: 15, name: "Extinct Ether", basePrice: 2000000000000, price: 2000000000000, change: 0, owned: 0 },
    { id: 16, name: "Tyranno Token", basePrice: 5000000000000, price: 5000000000000, change: 0, owned: 0 },
    { id: 17, name: "Spiketail Spark", basePrice: 10000000000000, price: 10000000000000, change: 0, owned: 0 },
    { id: 18, name: "Cretaceous Core", basePrice: 25000000000000, price: 25000000000000, change: 0, owned: 0 },
    { id: 19, name: "Meso Mint", basePrice: 50000000000000, price: 50000000000000, change: 0, owned: 0 },
    { id: 20, name: "Primal Pulse", basePrice: 100000000000000, price: 100000000000000, change: 0, owned: 0 }
  ]
},
  quests: [],
  dinoPoints: 0,
  clicks: 0,
  level: 1,
  xp: 0,
  xpToNextLevel: 100,
  lastInvestmentUpdate: Date.now(),
  lastDPSUpdate: Date.now(),
  currentTab: 'clicker',
  currentInvestmentTab: 'realEstate',
  questTab: 'quests',
  chestsOpened: 0,
  lastDailyBonus: null,
  dailyBonusDay: 0,
  telegramClicked: false,
  telegramBonusClaimed: false,
  telegramSubscribed: false,
};

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–≤–µ—Å—Ç–æ–≤
function generateQuests() {
  const quests = [
    {
      id: 1,
      name: "–ü–µ—Ä–≤—ã–µ —à–∞–≥–∏",
      description: "–°–¥–µ–ª–∞–π—Ç–µ 100 –∫–ª–∏–∫–æ–≤",
      type: 'clicks',
      required: 100,
      reward: 50,
      difficulty: Math.max(1, Math.floor(state.level / 5) + 1)
    },
    {
      id: 2,
      name: "–ù–∞—á–∞–ª—å–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª",
      description: "–ó–∞—Ä–∞–±–æ—Ç–∞–π—Ç–µ 1000 DINO",
      type: 'balance',
      required: 1000,
      reward: 75,
      difficulty: Math.max(1, Math.floor(state.level / 5) + 1)
    },
    {
      id: 3,
      name: "–ë–∏–∑–Ω–µ—Å —Å—Ç–∞—Ä—Ç",
      description: "–ö—É–ø–∏—Ç–µ –ø–µ—Ä–≤—ã–π –±–∏–∑–Ω–µ—Å",
      type: 'businesses',
      required: 1,
      reward: 75,
      difficulty: Math.max(2, Math.floor(state.level / 4) + 1)
    },
    {
      id: 4,
      name: "–≠–∫—Å–ø–µ—Ä—Ç –ø–æ –∫–ª–∏–∫–∞–º",
      description: "–°–¥–µ–ª–∞–π—Ç–µ 1000 –∫–ª–∏–∫–æ–≤",
      type: 'clicks',
      required: 1000,
      reward: 100,
      difficulty: Math.max(2, Math.floor(state.level / 4) + 1)
    },
    {
      id: 5,
      name: "–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –±–∞–∑–∞",
      description: "–ó–∞—Ä–∞–±–æ—Ç–∞–π—Ç–µ 10000 DINO",
      type: 'balance',
      required: 10000,
      reward: 100,
      difficulty: Math.max(3, Math.floor(state.level / 3) + 1)
    },
    {
      id: 6,
      name: "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏",
      description: "–ö—É–ø–∏—Ç–µ 3 –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏",
      type: 'investments',
      required: 3,
      reward: 100,
      difficulty: Math.max(3, Math.floor(state.level / 3) + 1)
    },
    {
      id: 7,
      name: "–ë–∏–∑–Ω–µ—Å-–∏–º–ø–µ—Ä–∏—è",
      description: "–ö—É–ø–∏—Ç–µ 5 –±–∏–∑–Ω–µ—Å–æ–≤",
      type: 'businesses',
      required: 5,
      reward: 125,
      difficulty: Math.max(4, Math.floor(state.level / 2) + 1)
    },
    {
      id: 8,
      name: "–ë–æ–≥–∞—Ç—Å—Ç–≤–æ",
      description: "–ó–∞—Ä–∞–±–æ—Ç–∞–π—Ç–µ 100000 DINO",
      type: 'balance',
      required: 100000,
      reward: 150,
      difficulty: Math.max(4, Math.floor(state.level / 2) + 1)
    }
  ];
  return quests;
}

// DOM —ç–ª–µ–º–µ–Ω—Ç—ã
const balanceEl = document.getElementById('balance');
const dpsEl = document.getElementById('dps');
const contentEl = document.getElementById('content');
const navBtns = document.querySelectorAll('.nav-btn');
const modalContainer = document.getElementById('modal-container');
const notifyContainer = document.getElementById('notification-container');

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–≤–µ—Å—Ç–æ–≤
function refreshQuests() {
  state.quests = generateQuests();
  state.lastQuestRefresh = Date.now();
  saveGame();
  if (state.currentTab === 'quests') renderQuests();
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
function initGame() {
  loadGame();
  updateDPS();
  state.lastQuestRefresh = state.lastQuestRefresh || Date.now();

  if (state.quests.length === 0) {
    refreshQuests();
  }

  renderScreen(state.currentTab);
  startGameLoop();
  setupEventListeners();
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –∏–≥—Ä—ã
function loadGame() {
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è purchaseHistory, –µ—Å–ª–∏ –æ–Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
  if (!state.purchaseHistory) {
    state.purchaseHistory = {
      realEstate: {},
      stocks: {},
      crypto: {}
    };
  }
  const savedGame = localStorage.getItem('dinoGameSave');
  if (savedGame) {
    const parsed = JSON.parse(savedGame);
    if (!parsed.telegramClicked) parsed.telegramClicked = false;
    if (!parsed.telegramBonusClaimed) parsed.telegramBonusClaimed = false;
    if (!parsed.telegramSubscribed) parsed.telegramSubscribed = false;
    if (!parsed.chestsOpened) parsed.chestsOpened = 0;
    if (!parsed.dinoPoints) parsed.dinoPoints = 0;
    if (!parsed.dailyBonusDay) parsed.dailyBonusDay = 0;
    if (!parsed.lastDailyBonus) parsed.lastDailyBonus = null;
    if (!parsed.clicks) parsed.clicks = 0;

    // –î–æ–±–∞–≤–ª—è–µ–º basePrice –∏ changePercent, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
    if (parsed.investments) {
      parsed.investments.realEstate.forEach((inv, index) => {
        if (!inv.basePrice) {
          inv.basePrice = state.investments.realEstate[index].basePrice;
        }
        if (!inv.changePercent) {
          inv.changePercent = 0;
        }
      });
      parsed.investments.stocks.forEach((inv, index) => {
        if (!inv.basePrice) {
          inv.basePrice = state.investments.stocks[index].basePrice;
        }
        if (!inv.changePercent) {
          inv.changePercent = 0;
        }
      });
      parsed.investments.crypto.forEach((inv, index) => {
        if (!inv.basePrice) {
          inv.basePrice = state.investments.crypto[index].basePrice;
        }
        if (!inv.changePercent) {
          inv.changePercent = 0;
        }
      });
    }

    if (!parsed.quests || parsed.quests.length === 0) {
      state.level = parsed.level || 1;
      parsed.quests = generateQuests();
    }

    Object.assign(state, parsed);
    updateUI();
  }
}
     if (!state.purchaseHistory) {
  state.purchaseHistory = {
    realEstate: {},
    stocks: {},
    crypto: {}
  };
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
function saveGame() {
  localStorage.setItem('dinoGameSave', JSON.stringify(state));
}

// –¶–∏–∫–ª –∏–≥—Ä—ã
function startGameLoop() {
  setInterval(() => {
    state.balance += state.dps;
    const now = Date.now();
    if (now - state.lastInvestmentUpdate > 60000) {
      updateInvestmentPrices();
      state.lastInvestmentUpdate = now;
    }

    if (state.quests.filter(q => !q.completed).length === 0 || now - state.lastQuestRefresh > 8 * 60 * 60 * 1000) {
      refreshQuests();
      state.lastQuestRefresh = now;
    }

    updateDPS();
    updateUI();
    saveGame();
  }, 1000);
}

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π —Å–æ–±—ã—Ç–∏–π
function setupEventListeners() {
  navBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      navBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      state.currentTab = btn.dataset.tab;
      renderScreen(state.currentTab);
    });
  });

  contentEl.addEventListener('click', e => {
    if (state.currentTab === 'clicker' && e.target.closest('#click-area')) {
      handleClick(e);
    }
  });
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞
function handleClick(e) {
  state.balance += state.perClick;
  state.clicks++;
  state.xp += 0.1;

  const clickArea = document.getElementById('click-area');
  const coin = document.createElement('div');
  coin.className = 'coin-animation';
  coin.innerHTML = `ü™ô +${state.perClick.toFixed(2)}`;
  coin.style.left = `${e.clientX - clickArea.getBoundingClientRect().left}px`;
  coin.style.top = `${e.clientY - clickArea.getBoundingClientRect().top}px`;
  clickArea.appendChild(coin);

  setTimeout(() => coin.remove(), 800);

  checkQuests('clicks');
  checkQuests('balance');
  checkLevelUp();
  updateUI();
  saveGame();
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω –Ω–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
function updateInvestmentPrices() {
  state.investments.realEstate.forEach(investment => {
    const changePercent = (Math.random() * 130) - 70; // –î–∏–∞–ø–∞–∑–æ–Ω –æ—Ç -70% –¥–æ +60%
    const newPrice = investment.basePrice * (1 + changePercent / 100);
    investment.change = (newPrice - investment.price).toFixed(2); // –†–∞–∑–Ω–∏—Ü–∞ –≤ DINO
    investment.price = Math.max(1000, newPrice.toFixed(2)); // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ 1000 DINO
    investment.changePercent = changePercent.toFixed(2); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
  });

  state.investments.stocks.forEach(investment => {
    const changePercent = (Math.random() * 130) - 70; // –î–∏–∞–ø–∞–∑–æ–Ω –æ—Ç -70% –¥–æ +60%
    const newPrice = investment.basePrice * (1 + changePercent / 100);
    investment.change = (newPrice - investment.price).toFixed(2); // –†–∞–∑–Ω–∏—Ü–∞ –≤ DINO
    investment.price = Math.max(100, newPrice.toFixed(2)); // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ 100 DINO
    investment.changePercent = changePercent.toFixed(2); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
  });

  state.investments.crypto.forEach(investment => {
    const changePercent = (Math.random() * 130) - 70; // –î–∏–∞–ø–∞–∑–æ–Ω –æ—Ç -70% –¥–æ +60%
    const newPrice = investment.basePrice * (1 + changePercent / 100);
    investment.change = (newPrice - investment.price).toFixed(2); // –†–∞–∑–Ω–∏—Ü–∞ –≤ DINO
    investment.price = Math.max(10, newPrice.toFixed(2)); // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ 10 DINO
    investment.changePercent = changePercent.toFixed(2); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
  });

  renderCurrentInvestmentTab(); // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
}
// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ DPS
function updateDPS() {
  state.dps = state.businesses.reduce((total, business) => {
    return total + (business.baseIncome * business.owned);
  }, 0);
  dpsEl.textContent = numberFormat(state.dps);
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
function updateUI() {
  balanceEl.textContent = numberFormat(state.balance);
  dpsEl.textContent = numberFormat(state.dps);
}

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª
function numberFormat(num) {
  if (num > 1000000000) return (num / 1000000000).toFixed(2) + 'B';
  if (num > 1000000) return (num / 1000000).toFixed(2) + 'M';
  if (num > 1000) return (num / 1000).toFixed(2) + 'K';
  return num.toFixed(2);
}

// –†–µ–Ω–¥–µ—Ä –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
function renderScreen(screen) {
  switch (screen) {
    case 'clicker': renderClicker(); break;
    case 'business': renderBusinesses(); break;
    case 'investments': renderInvestments(); break;
    case 'quests': renderQuests(); break;
    case 'profile': renderProfile(); break;
  }
}

// –†–µ–Ω–¥–µ—Ä –ö–ª–∏–∫–µ—Ä–∞
function renderClicker() {
  contentEl.innerHTML = `
    <div class="dino-box p-5 mb-4">
      <div class="flex justify-between text-lg">
        <span><span class="text-dinoPrimary font-bold">${state.perClick.toFixed(2)}</span> DINO <span class="text-sm text-gray-400">–∑–∞ –∫–ª–∏–∫</span></span>
        <span class="text-green-400 hidden md:block">‚ñ≤ 2.50 –∑–∞ —É–ª—É—á—à–µ–Ω–∏–µ</span>
      </div>
      <div class="w-full bg-gray-700 h-3 rounded-full mt-3">
        <div class="bg-dinoPrimary h-3 rounded-full" style="width: 35%"></div>
      </div>
      <div class="text-right text-sm mt-1">${numberFormat(state.clickUpgradeCost)} DINO</div>
      <div class="flex justify-between mt-4">
        <button class="bg-dinoPrimary hover:bg-green-600 text-white py-2 px-4 rounded-xl text-sm" onclick="openUpgradeModal()">–£–ª—É—á—à–∏—Ç—å</button>
        <button class="bg-dinoSecondary hover:bg-yellow-500 text-black py-2 px-4 rounded-xl text-sm" onclick="openBonuses()">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å</button>
      </div>
    </div>
    <div id="click-area" class="dino-box text-center p-8 cursor-pointer">
      <div class="text-6xl">ü¶ñ</div>
      <p class="mt-2 text-white text-sm">–ö–ª–∏–∫–∞–π—Ç–µ –ø–æ –¥–∏–Ω–æ–∑–∞–≤—Ä—É —á—Ç–æ–±—ã –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å DINO</p>
      <p class="text-gray-400 text-xs mt-4">–ö–ª–∏–∫–æ–≤: ${state.clicks}</p>
    </div>
  `;
}

// –†–µ–Ω–¥–µ—Ä –ë–∏–∑–Ω–µ—Å–∞
function renderBusinesses() {
  let businessesHTML = `
    <div class="dino-box p-4 mb-4">
      <h2 class="text-xl font-bold mb-4 text-center">–ë–∏–∑–Ω–µ—Å—ã</h2>
      <div class="max-h-[500px] overflow-y-auto">
  `;
  state.businesses.forEach(business => {
    const canBuy = state.balance >= business.cost;
    const dps = numberFormat(business.baseIncome);
    businessesHTML += `
      <div class="dino-box p-3 mb-3 flex items-center justify-between">
        <div class="flex-1">
          <div class="flex items-center">
            <i class="fas fa-store mr-2 text-dinoPrimary"></i>
            <div>
              <h3 class="font-bold">${business.name}</h3>
              <p class="text-xs text-dinoPrimary">${dps} DINO/—Å–µ–∫</p>
              <p class="text-xs text-gray-400">–£—Ä–æ–≤–µ–Ω—å: ${business.level}</p>
            </div>
          </div>
        </div>
        <div class="text-right ml-3">
          <p class="text-sm">${numberFormat(business.cost)} DINO</p>
          <p class="text-xs text-gray-400">–ö—É–ø–ª–µ–Ω–æ: ${business.owned}</p>
          <button class="mt-1 bg-dinoPrimary ${canBuy ? 'hover:bg-green-600' : 'opacity-50 cursor-not-allowed'} text-white py-1 px-3 rounded text-xs" onclick="buyBusiness(${business.id})">
            –ö—É–ø–∏—Ç—å
          </button>
        </div>
      </div>
    `;
  });
  businessesHTML += `
      </div>
    </div>
  `;
  contentEl.innerHTML = businessesHTML;
}

// –†–µ–Ω–¥–µ—Ä –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–π
function renderInvestments() {
  contentEl.innerHTML = `
    <div class="dino-box p-4">
      <h2 class="text-xl font-bold mb-4 text-center">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</h2>
      <div class="grid grid-cols-4 gap-2 mb-4">
        <button class="tab-btn ${state.currentInvestmentTab === 'realEstate' ? 'active' : ''} py-2 rounded text-xs" onclick="setInvestmentTab('realEstate')">–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</button>
        <button class="tab-btn ${state.currentInvestmentTab === 'stocks' ? 'active' : ''} py-2 rounded text-xs" onclick="setInvestmentTab('stocks')">–ê–∫—Ü–∏–∏</button>
        <button class="tab-btn ${state.currentInvestmentTab === 'crypto' ? 'active' : ''} py-2 rounded text-xs" onclick="setInvestmentTab('crypto')">–ö—Ä–∏–ø—Ç–∞</button>
        <button class="tab-btn ${state.currentInvestmentTab === 'wallet' ? 'active' : ''} py-2 rounded text-xs" onclick="setInvestmentTab('wallet')">–ú–æ–π –∫–æ—à–µ–ª–µ–∫</button>
      </div>
      <div id="investment-list" class="max-h-[500px] overflow-y-auto"></div>
    </div>
  `;
  renderCurrentInvestmentTab();
}

function renderCurrentInvestmentTab() {
  const container = document.getElementById('investment-list');
  if (!container) return;
  container.innerHTML = '';

  if (state.currentInvestmentTab === 'wallet') {
    renderWallet();
  } else {
    const investments = state.investments[state.currentInvestmentTab];
    investments.forEach(investment => {
      const changeColor = investment.change >= 0 ? 'text-green-400' : 'text-red-400';
      const changeIcon = investment.change >= 0 ? 'fa-arrow-up' : 'fa-arrow-down';
      const canBuy = state.balance >= investment.price;
      container.innerHTML += `
        <div class="dino-box p-3 mb-3">
          <div class="flex justify-between items-start">
            <div class="flex-1">
              <h3 class="font-bold">${investment.name}</h3>
              <p class="text-sm text-gray-400 mt-1">–¶–µ–Ω–∞: <span class="text-dinoPrimary">${numberFormat(investment.price)}</span> DINO</p>
              <p class="text-sm flex items-center">
                –ò–∑–º–µ–Ω–µ–Ω–∏–µ:
                <span class="${changeColor} ml-1">
                  <i class="fas ${changeIcon} mr-1"></i>
                  ${Math.abs(investment.change).toFixed(2)} (${Math.abs(investment.changePercent).toFixed(2)}%)
                </span>
              </p>
            </div>
            <div class="text-right pl-3">
              <button class="bg-dinoPrimary ${canBuy ? 'hover:bg-green-600' : 'opacity-50 cursor-not-allowed'} text-white py-1 px-3 rounded text-xs" onclick="buyInvestment(${investment.id}, '${state.currentInvestmentTab}')">
                –ö—É–ø–∏—Ç—å
              </button>
              <p class="text-xs mt-1">–í –Ω–∞–ª–∏—á–∏–∏: ${investment.owned}</p>
            </div>
          </div>
        </div>
      `;
    });
  }
}

function renderWallet() {
  const container = document.getElementById('investment-list');
  if (!container) return;
  const ownedAssets = [
    ...state.investments.realEstate.filter(i => i.owned > 0).map(i => ({ ...i, type: 'realEstate', typeName: '–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å' })),
    ...state.investments.stocks.filter(i => i.owned > 0).map(i => ({ ...i, type: 'stocks', typeName: '–ê–∫—Ü–∏–∏' })),
    ...state.investments.crypto.filter(i => i.owned > 0).map(i => ({ ...i, type: 'crypto', typeName: '–ö—Ä–∏–ø—Ç–∞' }))
  ];
  if (ownedAssets.length === 0) {
    container.innerHTML = `
      <div class="text-center py-6">
        <i class="fas fa-wallet text-3xl text-dinoPrimary mb-2"></i>
        <p class="text-lg">–í–∞—à –∫–æ—à–µ–ª–µ–∫ –ø—É—Å—Ç!</p>
        <p class="text-sm text-gray-400 mt-2">–ü–æ–∫—É–ø–∞–π—Ç–µ –∞–∫—Ç–∏–≤—ã –≤–æ –≤–∫–ª–∞–¥–∫–∞—Ö –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å, –ê–∫—Ü–∏–∏ –∏–ª–∏ –ö—Ä–∏–ø—Ç–∞.</p>
      </div>
    `;
    return;
  }
  container.innerHTML = `
    <div class="text-center mb-4">
      <h3 class="text-lg font-bold">–í–∞—à–∏ –∞–∫—Ç–∏–≤—ã</h3>
      <p class="text-sm text-gray-400">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${numberFormat(ownedAssets.reduce((sum, i) => sum + i.price * i.owned, 0))} DINO</p>
    </div>
  `;
  ownedAssets.forEach(asset => {
    const sellPrice = asset.price * 0.9;
    const purchasePrices = state.purchaseHistory[asset.type][asset.id] || [];
    container.innerHTML += `
      <div class="dino-box p-3 mb-3 investment-card wallet-card">
        <div class="flex justify-between items-start">
          <div class="flex-1">
            <div class="flex items-center">
              <i class="fas ${asset.type === 'realEstate' ? 'fa-home' : asset.type === 'stocks' ? 'fa-chart-line' : 'fa-coins'} text-dinoPrimary mr-2"></i>
              <div>
                <h3 class="font-bold">${asset.name}</h3>
                <p class="text-xs text-gray-400">${asset.typeName}</p>
              </div>
            </div>
            <p class="text-sm text-gray-400 mt-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${asset.owned}</p>
            <p class="text-sm text-gray-400">–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: ${numberFormat(asset.price)} DINO</p>
            <p class="text-sm text-gray-400">–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É: ${numberFormat(sellPrice)} DINO</p>
            <p class="text-sm text-dinoSecondary">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${numberFormat(asset.price * asset.owned)} DINO</p>
            <div class="purchase-history">
              <p class="text-sm text-gray-400 font-bold">–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫:</p>
              ${purchasePrices.length > 0 ? purchasePrices.slice(0, 2).map((price, index) => {
                const diff = sellPrice - price;
                const diffPercent = ((sellPrice - price) / price * 100).toFixed(2);
                const diffColor = diff >= 0 ? 'text-green-400' : 'text-red-400';
                return `
                  <p class="text-xs text-gray-400">–ï–¥–∏–Ω–∏—Ü–∞ ${index + 1}: –ö—É–ø–ª–µ–Ω–æ –∑–∞ ${numberFormat(Number(price))} DINO, –ø—Ä–æ–¥–∞–∂–∞: ${numberFormat(sellPrice)} DINO (<span class="${diffColor}">${diff >= 0 ? '+' : ''}${numberFormat(diff)} DINO, ${diffPercent}%</span>)</p>
                `;
              }).join('') : '<p class="text-xs text-gray-400">–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</p>'}
              ${purchasePrices.length > 2 ? `<button class="text-xs text-dinoPrimary hover:text-green-600 mt-1" onclick="openPurchaseHistoryModal(${asset.id}, '${asset.type}', '${asset.name}')">–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é</button>` : ''}
            </div>
          </div>
          <div class="text-right pl-3">
            <button class="bg-blue-500 hover:bg-blue-600 text-white py-1 px-3 rounded text-xs mb-2" onclick="openSellModal(${asset.id}, '${asset.type}', ${asset.owned}, ${sellPrice})">
              –ü—Ä–æ–¥–∞—Ç—å
            </button>
            <button class="bg-red-500 hover:bg-red-600 text-white py-1 px-3 rounded text-xs" onclick="sellAll(${asset.id}, '${asset.type}')">
              –ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ
            </button>
          </div>
        </div>
      </div>
    `;
  });
}

function sellAsset(id, type) {
  const asset = state.investments[type].find(i => i.id === id);
  if (!asset || asset.owned === 0) return;
  const sellPrice = asset.price * 0.9;
  state.balance += sellPrice;
  asset.owned--;
  if (state.purchaseHistory[type][id] && state.purchaseHistory[type][id].length > 0) {
    state.purchaseHistory[type][id].shift();
  }
  state.xp += 10;
  showNotification(`–í—ã –ø—Ä–æ–¥–∞–ª–∏ ${asset.name} –∑–∞ ${numberFormat(sellPrice)} DINO!`);
  checkLevelUp();
  updateUI();
  saveGame();
  renderWallet();
}

function sellAll(id, type) {
  const asset = state.investments[type].find(i => i.id === id);
  if (!asset || asset.owned === 0) return;
  const sellPrice = asset.price * 0.9 * asset.owned;
  state.balance += sellPrice;
  if (state.purchaseHistory[type][id]) {
    state.purchaseHistory[type][id] = [];
  }
  asset.owned = 0;
  state.xp += 10 * asset.owned;
  showNotification(`–í—ã –ø—Ä–æ–¥–∞–ª–∏ –≤—Å–µ ${asset.name} –∑–∞ ${numberFormat(sellPrice)} DINO!`);
  checkLevelUp();
  updateUI();
  saveGame();
  renderWallet();
}

function openSellModal(id, type, owned, sellPrice) {
  const asset = state.investments[type].find(i => i.id === id);
  if (!asset) return;
  const modalHTML = `
    <div class="modal-overlay" onclick="closeModal()">
      <div class="dino-modal" onclick="event.stopPropagation()">
        <h2 class="text-xl font-bold mb-4 text-center">–ü—Ä–æ–¥–∞—Ç—å ${asset.name}</h2>
        <div class="modal-content">
          <p class="text-sm text-gray-400 mb-2">–î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏: ${owned}</p>
          <p class="text-sm text-gray-400 mb-4">–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É: ${numberFormat(sellPrice)} DINO</p>
          <div class="mb-4">
            <label class="block text-sm text-gray-400 mb-2">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏:</label>
            <input id="sell-quantity" type="number" min="1" max="${owned}" value="1" class="w-full bg-dinoCard text-white p-2 rounded-lg border border-gray-600 focus:outline-none focus:border-dinoPrimary">
          </div>
          <div class="text-center mb-4">
            <p class="text-sm text-gray-400">–ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞: <span id="sell-total">${numberFormat(sellPrice)}</span> DINO</p>
          </div>
          <button class="w-full bg-dinoPrimary hover:bg-green-600 text-white py-3 rounded-lg text-lg font-bold" onclick="confirmSell(${id}, '${type}', ${sellPrice})">
            –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø—Ä–æ–¥–∞–∂—É
          </button>
        </div>
        <button class="absolute top-4 right-4 text-gray-400 hover:text-white" onclick="closeModal()">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
    </div>
  `;
  modalContainer.innerHTML = modalHTML;
  modalContainer.classList.remove('hidden');
  const quantityInput = document.getElementById('sell-quantity');
  const totalEl = document.getElementById('sell-total');
  quantityInput.addEventListener('input', () => {
    const quantity = Math.min(owned, Math.max(1, parseInt(quantityInput.value) || 1));
    totalEl.textContent = numberFormat(quantity * sellPrice);
  });
}

    function confirmSell(id, type, sellPrice) {
  const asset = state.investments[type].find(i => i.id === id);
  if (!asset) return;
  const quantity = parseInt(document.getElementById('sell-quantity').value) || 1;
  if (quantity > asset.owned) {
    alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–∫—Ç–∏–≤–æ–≤ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏!');
    return;
  }
  const totalSellPrice = sellPrice * quantity;
  state.balance += totalSellPrice;
  asset.owned -= quantity;
  if (state.purchaseHistory[type][id]) {
    state.purchaseHistory[type][id] = state.purchaseHistory[type][id].slice(quantity);
  }
  state.xp += 10 * quantity;
  showNotification(`–í—ã –ø—Ä–æ–¥–∞–ª–∏ ${quantity} ${asset.name} –∑–∞ ${numberFormat(totalSellPrice)} DINO!`);
  checkLevelUp();
  updateUI();
  saveGame();
  closeModal();
  renderWallet();
}

// –†–µ–Ω–¥–µ—Ä –ö–≤–µ—Å—Ç–æ–≤
function renderQuests() {
  let questsHTML = `
    <div class="dino-box p-4 mb-4">
      <div class="flex justify-center space-x-3 mb-4">
        <button id="quests-tab" class="tab-btn ${state.questTab === 'quests' ? 'active' : ''} py-2 px-4 rounded text-sm font-medium" onclick="setQuestTab('quests')">–ö–≤–µ—Å—Ç—ã</button>
        <button id="chest-tab" class="tab-btn ${state.questTab === 'chest' ? 'active' : ''} py-2 px-4 rounded text-sm font-medium" onclick="setQuestTab('chest')">–Ø—â–∏–∫</button>
      </div>
      <div id="quest-content" class="mt-3"></div>
      <p class="text-center text-gray-400 text-xs mt-4">
        <i class="fas fa-sync-alt mr-1"></i>
        –ù–æ–≤—ã–µ –∫–≤–µ—Å—Ç—ã —á–µ—Ä–µ–∑: <span id="quest-timer">07:59:59</span>
      </p>
    </div>
  `;
  contentEl.innerHTML = questsHTML;
  renderQuestContent();
  startQuestTimer();
}

function renderQuestContent() {
  const container = document.getElementById('quest-content');
  if (!container) return;
  if (state.questTab === 'chest') {
    renderChestTab();
  } else {
    renderQuestsList();
  }
}

function startQuestTimer() {
  const timerEl = document.getElementById('quest-timer');
  if (!timerEl) return;
  const lastRefresh = state.lastQuestRefresh || Date.now();
  const nextRefresh = lastRefresh + (8 * 60 * 60 * 1000);
  function updateTimer() {
    const now = Date.now();
    const diff = nextRefresh - now;
    if (diff <= 0) {
      timerEl.textContent = '00:00:00';
      refreshQuests();
      return;
    }
    const hours = Math.floor(diff / (1000 * 60 * 60)).toString().padStart(2, '0');
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60)).toString().padStart(2, '0');
    const seconds = Math.floor((diff % (1000 * 60)) / 1000).toString().padStart(2, '0');
    timerEl.textContent = `${hours}:${minutes}:${seconds}`;
    requestAnimationFrame(updateTimer);
  }
  updateTimer();
}

function renderQuestsList() {
  const container = document.getElementById('quest-content');
  if (!container) return;
  container.innerHTML = '<h3 class="text-lg font-bold mb-1 text-center">–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</h3>';
  const activeQuests = state.quests.slice().sort((a, b) => {
    if (a.completed && !b.completed) return 1;
    if (!a.completed && b.completed) return -1;
    return 0;
  });
  if (activeQuests.length === 0) {
    container.innerHTML += `
      <div class="text-center py-6">
        <i class="fas fa-tasks text-3xl text-dinoPrimary mb-2"></i>
        <p>–í—Å–µ –∑–∞–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã!</p>
        <p class="text-sm text-gray-400 mt-2">–ù–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è</p>
      </div>
    `;
    return;
  }
  activeQuests.forEach(quest => {
    const progress = getQuestProgress(quest);
const validProgress = isNaN(progress) ? 0 : progress;
const progressPercent = Math.min(100, (validProgress / quest.required) * 100);
const canComplete = validProgress >= quest.required && !quest.completed;
const stars = '‚òÖ'.repeat(quest.difficulty);
container.innerHTML += `
  <div class="dino-box p-3 mb-3 ${quest.completed ? 'quest-completed' : ''}">
    <div class="flex justify-between items-center mb-2">
      <h4 class="font-bold">${quest.name}</h4>
      ${quest.completed ? '<i class="fas fa-check-circle text-dinoPrimary ml-2"></i>' : ''}
      <span class="difficulty-star" title="–°–ª–æ–∂–Ω–æ—Å—Ç—å">${stars}</span>
    </div>
    <p class="text-sm text-gray-400 my-2">${quest.description}</p>
    <div class="flex items-center justify-between mb-1">
      <span class="text-dinoSecondary font-bold">${quest.reward} DINO Points</span>
      <span class="text-xs">${Math.floor(progressPercent)}%</span>
    </div>
    <div class="w-full bg-gray-700 h-2 rounded-full mt-2">
      <div class="bg-dinoPrimary h-2 rounded-full" style="width: ${progressPercent}%"></div>
    </div>
    <p class="text-xs text-right mt-1">${validProgress.toFixed(0)} / ${quest.required.toFixed(0)}</p>
    <button class="mt-2 w-full bg-dinoPrimary hover:bg-green-600 text-white py-2 rounded text-sm ${canComplete ? 'animate-highlightButton' : ''}" onclick="completeQuest(${quest.id})" ${quest.completed || !canComplete ? 'disabled' : ''}>
      ${quest.completed ? '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' : '–ü–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É'}
    </button>
  </div>
    `;
  });
}

function renderChestTab() {
  const container = document.getElementById('quest-content');
  if (!container) return;
  const canOpen = state.dinoPoints >= 250;
  container.innerHTML = `
    <div class="text-center">
      <h3 class="text-xl font-bold mb-3">–Ø—â–∏–∫ —Å —Å—é—Ä–ø—Ä–∏–∑–æ–º</h3>
      <div class="mt-4 mb-3">
        <div class="flex justify-center items-center">
          <div class="bg-dinoCard rounded-full w-12 h-12 flex items-center justify-center">
            <i class="fas fa-gem text-2xl text-dinoPrimary"></i>
          </div>
          <div class="ml-3 text-left">
            <p class="text-gray-400 text-sm">–û—á–∫–∏ DINO:</p>
            <p class="text-2xl font-bold text-dinoPrimary">${state.dinoPoints}</p>
          </div>
        </div>
      </div>
      <p class="text-gray-400 mb-4">–ù–∞–∫–æ–ø–∏—Ç–µ 250 –æ—á–∫–æ–≤ DINO –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —è—â–∏–∫–∞</p>
      <div class="flex items-center justify-center text-sm mb-4">
        <div class="bg-dinoCard p-2 rounded-lg">
          <i class="fas fa-coins text-dinoSecondary"></i>
          <span class="ml-2">${state.dinoPoints}/250</span>
        </div>
      </div>
      <div class="chest-container">
        <div id="chest" class="chest ${canOpen ? 'cursor-pointer' : 'opacity-70'}" onclick="if(${canOpen}) openChest()">
          <div class="chest-top"><div>D</div></div>
          <div class="chest-body"><div>?</div></div>
        </div>
      </div>
      <p class="text-gray-400 text-sm mt-4">–Ø—â–∏–∫–∏ –æ—Ç–∫—Ä—ã—Ç–æ: ${state.chestsOpened}</p>
      <div class="mt-6 flex justify-center">
        <button class="bg-dinoPrimary hover:bg-green-600 text-white py-3 px-8 rounded-lg text-lg font-bold flex items-center ${canOpen ? '' : 'opacity-50 cursor-not-allowed'}" onclick="if(${canOpen}) openChest()">
          –û—Ç–∫—Ä—ã—Ç—å —è—â–∏–∫ (250 DINO Points)
        </button>
      </div>
    </div>
  `;
}

// –†–µ–Ω–¥–µ—Ä –ü—Ä–æ—Ñ–∏–ª—è
function renderProfile() {
  const totalBusinesses = state.businesses.reduce((sum, b) => sum + b.owned, 0);
  const totalInvestments = Object.values(state.investments).flat().reduce((sum, i) => sum + i.owned, 0);
  const progressPercent = (state.xp / state.xpToNextLevel) * 100;
  contentEl.innerHTML = `
    <div class="dino-box p-5">
      <h2 class="text-xl font-bold mb-4 text-center">–ü—Ä–æ—Ñ–∏–ª—å</h2>
      <div class="flex items-center justify-center mb-6">
        <div class="relative">
          <div class="w-24 h-24 rounded-full border-4 border-dinoPrimary bg-dinoCard flex items-center justify-center">
            <i class="fas fa-dragon text-4xl text-dinoSecondary"></i>
          </div>
          <div class="absolute -bottom-2 left-1/2 transform -translate-x-1/2 bg-dinoPrimary text-white rounded-full px-3 py-1 text-xs font-bold">
            –£—Ä–æ–≤–µ–Ω—å ${state.level}
          </div>
        </div>
      </div>
      <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="dino-box p-3 text-center">
          <i class="fas fa-coins text-2xl text-dinoSecondary mb-2"></i>
          <p class="font-bold">${numberFormat(state.balance)}</p>
          <p class="text-xs text-gray-400">–í—Å–µ–≥–æ DINO</p>
        </div>
        <div class="dino-box p-3 text-center">
          <i class="fas fa-hand-pointer text-2xl text-dinoSecondary mb-2"></i>
          <p class="font-bold">${state.clicks}</p>
          <p class="text-xs text-gray-400">–í—Å–µ–≥–æ –∫–ª–∏–∫–æ–≤</p>
        </div>
        <div class="dino-box p-3 text-center">
          <i class="fas fa-building text-2xl text-dinoSecondary mb-2"></i>
          <p class="font-bold">${totalBusinesses}</p>
          <p class="text-xs text-gray-400">–ë–∏–∑–Ω–µ—Å—ã</p>
        </div>
        <div class="dino-box p-3 text-center">
          <i class="fas fa-gem text-2xl text-dinoSecondary mb-2"></i>
          <p class="font-bold">${state.dinoPoints}</p>
          <p class="text-xs text-gray-400">–û—á–∫–∏ DINO</p>
        </div>
      </div>
      <div class="mb-6">
        <h3 class="font-bold mb-2 flex justify-between">
          <span>–ü—Ä–æ–≥—Ä–µ—Å—Å —É—Ä–æ–≤–Ω—è</span>
          <span>${Math.floor(progressPercent)}%</span>
        </h3>
        <div class="w-full bg-gray-700 h-3 rounded-full">
          <div class="bg-dinoPrimary h-3 rounded-full" style="width: ${progressPercent}%"></div>
        </div>
        <div class="flex justify-between mt-1">
          <span class="text-xs">${state.xp.toFixed(0)}</span>
          <span class="text-xs">${state.xpToNextLevel.toFixed(0)}</span>
        </div>
      </div>
      <div class="flex justify-center">
        <p class="text-xs text-center text-gray-400">
          –î–æ—Ö–æ–¥ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ ${state.level * 5}% –∑–∞ —Å—á–µ—Ç –≤–∞—à–µ–≥–æ —É—Ä–æ–≤–Ω—è
        </p>
      </div>
    </div>
  `;
}

// –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–ª—É—á—à–µ–Ω–∏—è
function openUpgradeModal() {
  const modalHTML = `
    <div class="modal-overlay" onclick="closeModal()">
      <div class="dino-modal" onclick="event.stopPropagation()">
        <h2 class="text-xl font-bold mb-4 text-center">–£–ª—É—á—à–µ–Ω–∏–µ –∫–ª–∏–∫–∞</h2>
        <div class="modal-content">
          <div class="flex justify-center mb-6">
            <div class="bg-dinoCard rounded-full w-16 h-16 flex items-center justify-center">
              <i class="fas fa-hand-pointer text-3xl text-dinoPrimary"></i>
            </div>
          </div>
          <div class="dino-box p-4 mb-4">
            <div class="flex justify-between text-sm mb-2">
              <span>–¢–µ–∫—É—â–∏–π –¥–æ—Ö–æ–¥ –∑–∞ –∫–ª–∏–∫:</span>
              <span class="text-dinoPrimary font-bold">${state.perClick.toFixed(2)} DINO</span>
            </div>
            <div class="flex justify-between text-sm">
              <span>–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è:</span>
              <span class="text-dinoSecondary font-bold">${(state.perClick + 2.50).toFixed(2)} DINO</span>
            </div>
          </div>
          <div class="dino-box p-4">
            <div class="flex justify-between items-center mb-3">
              <span>–°—Ç–æ–∏–º–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∏—è:</span>
              <span class="text-xl font-bold ${state.balance >= state.clickUpgradeCost ? 'text-dinoSecondary' : 'text-red-400'}">
                ${numberFormat(state.clickUpgradeCost)} DINO
              </span>
            </div>
            <button onclick="buyClickUpgrade(); closeModal();" class="w-full bg-dinoPrimary hover:bg-green-600 text-white py-3 rounded-lg text-lg font-bold ${state.balance >= state.clickUpgradeCost ? '' : 'opacity-50 cursor-not-allowed'}">
              –£–ª—É—á—à–∏—Ç—å
            </button>
          </div>
        </div>
        <button class="absolute top-4 right-4 text-gray-400 hover:text-white" onclick="closeModal()">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
    </div>
  `;
  modalContainer.innerHTML = modalHTML;
  modalContainer.classList.remove('hidden');
}

// –ë–æ–Ω—É—Å—ã: –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã
function openBonuses() {
  const now = new Date();
  const lastBonus = state.lastDailyBonus ? new Date(state.lastDailyBonus) : null;
  const canClaim = !lastBonus || (now - lastBonus) >= 24 * 60 * 60 * 1000;
  const dailyBonuses = [
    { day: 1, reward: 1000 },
    { day: 2, reward: 2500 },
    { day: 3, reward: 5000 },
    { day: 4, reward: 10000 },
    { day: 5, reward: 25000 },
    { day: 6, reward: 50000 },
    { day: 7, reward: 100000 },
    { day: 8, reward: 250000 }
  ];
  const nextDay = state.dailyBonusDay >= 7 ? 0 : state.dailyBonusDay;
  const modalHTML = `
    <div class="modal-overlay" onclick="closeModal()">
      <div class="dino-modal" onclick="event.stopPropagation()">
        <h2 class="text-xl font-bold mb-4 text-center">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±–æ–Ω—É—Å—ã</h2>
        <div class="modal-content">
          <div class="dino-box p-4 mb-4">
            <div class="flex items-start">
              <div class="bg-yellow-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3">
                <i class="fas fa-calendar-day"></i>
              </div>
              <div>
                <h3 class="font-bold mb-1">${canClaim ? '–ó–∞–±–µ—Ä–∏—Ç–µ –≤–∞—à –±–æ–Ω—É—Å!' : '–ë–æ–Ω—É—Å —É–∂–µ –ø–æ–ª—É—á–µ–Ω!'}</h3>
                <p class="text-sm text-gray-400">${canClaim ? '–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –±–æ–Ω—É—Å –∂–¥–µ—Ç –≤–∞—Å!' : '–í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å –∑–∞ –Ω–æ–≤—ã–º –±–æ–Ω—É—Å–æ–º –∑–∞–≤—Ç—Ä–∞!'}</p>
              </div>
            </div>
          </div>
          ${state.telegramBonusClaimed ? `
            <div class="dino-box p-4 mb-4 bg-green-900 bg-opacity-30">
              <div class="flex items-center">
                <div class="bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3">
                  <i class="fas fa-check"></i>
                </div>
                <div>
                  <h3 class="font-bold">–í—ã –ø–æ–ª—É—á–∏–ª–∏ –±–æ–Ω—É—Å –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É!</h3>
                  <p class="text-sm text-gray-400">–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –Ω–∞—à –∫–∞–Ω–∞–ª!</p>
                </div>
              </div>
            </div>
          ` : `
            <div class="dino-box p-4 mb-4">
              <div class="flex items-start">
                <div class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3">
                  <i class="fab fa-telegram"></i>
                </div>
                <div>
                  <h3 class="font-bold mb-1">–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ Telegram</h3>
                  <p class="text-sm text-gray-400">–ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –Ω–∞—à –∫–∞–Ω–∞–ª –∏ –ø–æ–ª—É—á–∏—Ç–µ –±–æ–Ω—É—Å 100.000 DINO!</p>
                  <a href="https://t.me/dinogamed" target="_blank" id="telegram-link" class="text-blue-400 text-sm block mt-1">https://t.me/dinogamed</a>
                </div>
              </div>
              <button id="claim-telegram-bonus" class="mt-3 w-full py-2 rounded-lg ${state.telegramSubscribed ? 'bg-dinoPrimary hover:bg-green-600' : 'bg-gray-600'} text-white" ${state.telegramSubscribed ? '' : 'disabled'}>
                <i class="fas fa-gift mr-2"></i> ${state.telegramSubscribed ? '–ó–∞–±—Ä–∞—Ç—å 100K DINO' : '–ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å, —á—Ç–æ–±—ã –∑–∞–±—Ä–∞—Ç—å'}
              </button>
            </div>
          `}
          <div class="dino-box p-4">
            <div class="flex justify-between items-center mb-3">
              <div class="flex items-center">
                <i class="fas ${canClaim ? 'fa-gift text-dinoPrimary' : 'fa-clock text-gray-500'} text-2xl mr-2"></i>
                <div>
                  <h4 class="font-bold">${canClaim ? '–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –±–æ–Ω—É—Å' : '–°–ª–µ–¥—É—é—â–∏–π –±–æ–Ω—É—Å'}</h4>
                  <p class="text-xs text-gray-400">${dailyBonuses[canClaim ? state.dailyBonusDay : nextDay].day} –¥–µ–Ω—å</p>
                </div>
              </div>
              <button id="claim-bonus-btn" onclick="claimDailyBonus()" class="bg-dinoPrimary ${canClaim ? 'hover:bg-green-600' : 'opacity-50 cursor-not-allowed'} text-white py-1 px-3 rounded text-sm">
                ${canClaim ? '–ó–∞–±—Ä–∞—Ç—å' : '–ó–∞–∫—Ä—ã—Ç—å'}
              </button>
            </div>
            <p class="text-center text-dinoSecondary font-bold">${numberFormat(dailyBonuses[canClaim ? state.dailyBonusDay : nextDay].reward)} DINO</p>
          </div>
        </div>
        <button class="absolute top-4 right-4 text-gray-400 hover:text-white" onclick="closeModal()">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
    </div>
  `;
  modalContainer.innerHTML = modalHTML;
  modalContainer.classList.remove('hidden');
  if (!state.telegramBonusClaimed) {
    const telegramLink = modalContainer.querySelector('#telegram-link');
    const claimBtn = modalContainer.querySelector('#claim-telegram-bonus');
    if (telegramLink && claimBtn) {
      telegramLink.addEventListener('click', () => {
        state.telegramSubscribed = true;
        claimBtn.disabled = false;
        claimBtn.classList.remove('bg-gray-600');
        claimBtn.classList.add('bg-dinoPrimary', 'hover:bg-green-600');
        claimBtn.innerHTML = '<i class="fas fa-gift mr-2"></i> –ó–∞–±—Ä–∞—Ç—å 100K DINO';
        saveGame();
      });
      claimBtn.addEventListener('click', () => {
        if (state.telegramSubscribed && !state.telegramBonusClaimed) {
          state.balance += 100000;
          state.telegramBonusClaimed = true;
          showNotification('–í—ã –ø–æ–ª—É—á–∏–ª–∏ 100.000 DINO –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ Telegram!');
          saveGame();
          updateUI();
          openBonuses();
        }
      });
    }
  }
}

// –ü–æ–∫—É–ø–∫–∞ –±–∏–∑–Ω–µ—Å–∞
function buyBusiness(id) {
  const business = state.businesses.find(b => b.id === id);
  if (!business) return;
  if (state.balance >= business.cost) {
    state.balance -= business.cost;
    business.owned++;
    business.level++;
    business.cost = Math.round(business.cost * 1.18);
    state.xp += 15;
    checkLevelUp();
    checkQuests('businesses');
    updateDPS();
    updateUI();
    saveGame();
  } else {
    alert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ DINO –¥–ª—è –ø–æ–∫—É–ø–∫–∏ ${business.name}!`);
  }
}
// –ü–æ–∫—É–ø–∫–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
function buyInvestment(id, type) {
  const investment = state.investments[type].find(i => i.id === id);
  if (!investment) return;
  if (state.balance >= investment.price) {
    state.balance -= investment.price;
    investment.owned++;
    if (!state.purchaseHistory[type][id]) {
      state.purchaseHistory[type][id] = [];
    }
    state.purchaseHistory[type][id].push(Number(investment.price)); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ü–µ–Ω—É –∫–∞–∫ —á–∏—Å–ª–æ
    state.xp += 20;
    checkLevelUp();
    checkQuests('investments');
    updateUI();
    saveGame();
  } else {
    alert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ DINO –¥–ª—è –ø–æ–∫—É–ø–∫–∏ ${investment.name}!`);
  }
}

// –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–≤–µ—Å—Ç–∞
function completeQuest(id) {
  const quest = state.quests.find(q => q.id === id);
  if (!quest || quest.completed) return;
  const progress = getQuestProgress(quest);
  if (progress < quest.required) return;
  quest.completed = true;
  state.dinoPoints += quest.reward;
  state.xp += Math.max(15, Math.floor(quest.reward / 5));
  checkLevelUp();
  showNotification(`–í—ã –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –∫–≤–µ—Å—Ç "${quest.name}" –∏ –ø–æ–ª—É—á–∏–ª–∏ ${quest.reward} DINO Points`);
  if (state.quests.filter(q => !q.completed).length === 0) {
    refreshQuests();
  }
  renderQuests();
  updateUI();
  saveGame();
}

// –ü–æ–ª—É—á–∏—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å
function claimDailyBonus() {
  const now = new Date();
  const lastBonus = state.lastDailyBonus ? new Date(state.lastDailyBonus) : null;
  if (lastBonus && (now - lastBonus) < 24 * 60 * 60 * 1000) {
    alert('–í—ã —É–∂–µ –ø–æ–ª—É—á–∞–ª–∏ –±–æ–Ω—É—Å —Å–µ–≥–æ–¥–Ω—è! –í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å –∑–∞–≤—Ç—Ä–∞.');
    return;
  }
  const dailyBonuses = [
    { day: 1, reward: 1000 },
    { day: 2, reward: 2500 },
    { day: 3, reward: 5000 },
    { day: 4, reward: 10000 },
    { day: 5, reward: 25000 },
    { day: 6, reward: 50000 },
    { day: 7, reward: 100000 },
    { day: 8, reward: 250000 }
  ];
  const currentDayBonus = dailyBonuses[state.dailyBonusDay];
  state.balance += currentDayBonus.reward;
  state.lastDailyBonus = now;
  state.dailyBonusDay = state.dailyBonusDay >= 7 ? 0 : state.dailyBonusDay + 1;
  showNotification(`–í—ã –ø–æ–ª—É—á–∏–ª–∏ ${currentDayBonus.reward} DINO –∑–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å!`);
  updateUI();
  saveGame();
  closeModal();
}

// –û—Ç–∫—Ä—ã—Ç–∏–µ —è—â–∏–∫–∞
function openChest() {
  if (state.dinoPoints < 250) {
    alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ DINO!");
    return;
  }
  state.dinoPoints -= 250;
  state.chestsOpened++;
  state.lastChestOpened = Date.now();
  const rewards = [
    { id: 1, value: 10000 + Math.floor(Math.random() * 10000), chance: 0.4 },
    { id: 2, value: 25000 + Math.floor(Math.random() * 15000), chance: 0.3 },
    { id: 3, value: 50000 + Math.floor(Math.random() * 25000), chance: 0.2 },
    { id: 4, value: 80000 + Math.floor(Math.random() * 70000), chance: 0.1 }
  ];
  const rand = Math.random();
  let cumulative = 0;
  let selectedReward = null;
  for (const reward of rewards) {
    cumulative += reward.chance;
    if (rand <= cumulative) {
      selectedReward = reward;
      break;
    }
  }
  selectedReward.value = Math.floor(selectedReward.value * (1 + state.level * 0.15));
  state.balance += selectedReward.value;
  showChestRewardModal(selectedReward, rewards);
}

// –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –Ω–∞–≥—Ä–∞–¥–∞–º–∏ —Å—É–Ω–¥—É–∫–∞
function showChestRewardModal(selectedReward, rewards) {
  const modalHTML = `
    <div class="modal-overlay" onclick="closeModal()">
      <div class="dino-modal" onclick="event.stopPropagation()">
        <h2 class="text-xl font-bold mb-4 text-center">–ù–∞–≥—Ä–∞–¥–∞ –∏–∑ —Å—É–Ω–¥—É–∫–∞</h2>
        <div class="text-center mb-4">
          <p class="text-lg">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –æ—Ç–∫—Ä—ã—Ç–∏–µ–º —Å—É–Ω–¥—É–∫–∞!</p>
          <p class="text-sm text-gray-400">–í—ã –ø–æ–ª—É—á–∏–ª–∏:</p>
        </div>
        <div class="reward-grid">
          ${rewards.map(reward => `
            <div id="reward-${reward.id}" class="reward-card ${reward.id === selectedReward.id ? 'selected card-highlight' : ''}">
              <div class="text-xl font-bold mb-2">${numberFormat(reward.value)} DINO</div>
              <div class="text-sm">${reward.chance * 100}% —à–∞–Ω—Å</div>
            </div>
          `).join('')}
        </div>
        <div class="text-center mt-6">
          <button onclick="closeModal()" class="bg-dinoPrimary hover:bg-green-600 text-white py-3 px-8 rounded-lg">
            –ó–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É
          </button>
        </div>
      </div>
    </div>
  `;
  modalContainer.innerHTML = modalHTML;
  modalContainer.classList.remove('hidden');
  if (selectedReward) {
    setTimeout(() => {
      const selectedCard = document.getElementById(`reward-${selectedReward.id}`);
      if (selectedCard) selectedCard.classList.add('card-highlight');
    }, 500);
  }
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
function showNotification(message) {
  const notification = document.createElement('div');
  notification.className = 'notify-modal';
  notification.innerHTML = `
    <div class="flex items-center">
      <i class="fas fa-check-circle text-dinoPrimary mr-2"></i>
      <p>${message}</p>
    </div>
  `;
  notifyContainer.appendChild(notification);
  setTimeout(() => {
    notification.style.opacity = '0';
    notification.style.transform = 'translateX(20px)';
    setTimeout(() => notification.remove(), 300);
  }, 3000);
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è
function checkLevelUp() {
  if (state.xp >= state.xpToNextLevel) {
    state.level++;
    state.xp = 0;
    state.xpToNextLevel = Math.round(state.xpToNextLevel * 1.8);
    showNotification(`–í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ —É—Ä–æ–≤–Ω—è ${state.level}! –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã!`);
    refreshQuests();
    saveGame();
  }
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–µ—Å—Ç–æ–≤
function checkQuests(type) {
  const relevantQuests = state.quests.filter(q => q.type === type && !q.completed);
  relevantQuests.forEach(quest => {
    const progress = getQuestProgress(quest);
  });
}

// –ü—Ä–æ–≥—Ä–µ—Å—Å –∫–≤–µ—Å—Ç–∞
function getQuestProgress(quest) {
  switch (quest.type) {
    case 'balance': return isNaN(state.balance) ? 0 : state.balance;
    case 'clicks': return isNaN(state.clicks) ? 0 : state.clicks;
    case 'businesses': return state.businesses.reduce((total, b) => total + (isNaN(b.owned) ? 0 : b.owned), 0);
    case 'investments': return Object.values(state.investments).flat().reduce((total, i) => total + (isNaN(i.owned) ? 0 : i.owned), 0);
    default: return 0;
  }
}

// –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
function closeModal() {
  modalContainer.innerHTML = '';
  modalContainer.classList.add('hidden');
}

window.setInvestmentTab = function(tab) {
  state.currentInvestmentTab = tab;
  renderInvestments();
}

window.setQuestTab = function(tab) {
  state.questTab = tab;
  document.querySelectorAll('#quests-tab, #chest-tab').forEach(btn => btn.classList.remove('active'));
  if (tab === 'quests') {
    document.getElementById('quests-tab').classList.add('active');
  } else {
    document.getElementById('chest-tab').classList.add('active');
  }
  renderQuestContent();
}

window.buyClickUpgrade = function() {
  if (state.balance >= state.clickUpgradeCost) {
    state.balance -= state.clickUpgradeCost;
    state.perClick += 2.50;
    state.clickUpgradeCost = Math.round(state.clickUpgradeCost * 1.5);
    state.xp += 10;
    checkLevelUp();
    updateUI();
    saveGame();
  }
};
window.buyBusiness = buyBusiness;
window.buyInvestment = buyInvestment;
window.completeQuest = completeQuest;
window.openChest = openChest;
window.openBonuses = openBonuses;
window.openUpgradeModal = openUpgradeModal;
window.claimDailyBonus = claimDailyBonus;
window.closeModal = closeModal;
window.sellAsset = sellAsset;
window.sellAll = sellAll;
window.openSellModal = openSellModal;
window.confirmSell = confirmSell;
window.openPurchaseHistoryModal = openPurchaseHistoryModal;

function openPurchaseHistoryModal(id, type, name) {
  const purchasePrices = state.purchaseHistory[type][id] || [];
  const asset = state.investments[type].find(i => i.id === id);
  if (!asset) return;
  const sellPrice = asset.price * 0.9;
  const modalHTML = `
    <div class="modal-overlay" onclick="closeModal()">
      <div class="dino-modal" onclick="event.stopPropagation()">
        <h2 class="text-xl font-bold mb-4 text-center">–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫: ${name}</h2>
        <div class="modal-content">
          <p class="text-sm text-gray-400 mb-2">–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É: ${numberFormat(sellPrice)} DINO</p>
          <div class="max-h-[300px] overflow-y-auto">
            ${purchasePrices.length > 0 ? purchasePrices.map((price, index) => {
              const diff = sellPrice - price;
              const diffPercent = ((sellPrice - price) / price * 100).toFixed(2);
              const diffColor = diff >= 0 ? 'text-green-400' : 'text-red-400';
              return `
                <div class="dino-box p-2 mb-2">
                  <p class="text-xs text-gray-400">–ï–¥–∏–Ω–∏—Ü–∞ ${index + 1}: –ö—É–ø–ª–µ–Ω–æ –∑–∞ ${numberFormat(price)} DINO</p>
                  <p class="text-xs text-gray-400">–ü—Ä–æ–¥–∞–∂–∞: ${numberFormat(sellPrice)} DINO (<span class="${diffColor}">${diff >= 0 ? '+' : ''}${numberFormat(diff)} DINO, ${diffPercent}%</span>)</p>
                </div>
              `;
            }).join('') : '<p class="text-sm text-gray-400">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–∫—É–ø–∫–∞—Ö</p>'}
          </div>
          <button class="w-full bg-dinoPrimary hover:bg-green-600 text-white py-3 rounded-lg text-lg font-bold mt-4" onclick="closeModal()">
            –ó–∞–∫—Ä—ã—Ç—å
          </button>
        </div>
        <button class="absolute top-4 right-4 text-gray-400 hover:text-white" onclick="closeModal()">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
    </div>
  `;
  modalContainer.innerHTML = modalHTML;
  modalContainer.classList.remove('hidden');
}

document.addEventListener('DOMContentLoaded', initGame);
</script>
</body>
</html>

