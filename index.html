<!DOCTYPE html>
<html lang="ru" id="html-root">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Business Empire Richman</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://telegram.org/js/telegram-web-app.js"></script> <!-- Telegram Web App SDK -->
  <style>
    :root {
      --bg-primary: #f0f4f8;
      --bg-secondary: #ffffff;
      --text-primary: #1a1a1a;
      --text-secondary: #6b7280;
      --card-bg: #ffffff;
      --card-border: #e5e7eb;
      --accent: #29d9a0;
      --accent-light: #e0f7f0;
      --nav-bg: #ffffff;
      --nav-shadow: 0 -2px 20px rgba(0, 0, 0, 0.08);
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.08);
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.12);
      --border-radius: 18px;
      --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      --card-gradient-1: #1a2980;
      --card-gradient-2: #26d0ce;
      --card-chip: #c9a66b;
      --card-text: #ffffff;
    }

    [data-theme="dark"] {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --text-primary: #f8fafc;
      --text-secondary: #94a3b8;
      --card-bg: #1e293b;
      --card-border: #334155;
      --accent: #4FFFB0;
      --accent-light: rgba(79, 255, 176, 0.1);
      --nav-bg: #1e293b;
      --nav-shadow: 0 -2px 20px rgba(0, 0, 0, 0.4);
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.2);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.3);
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.4);
      --card-gradient-1: #0f2027;
      --card-gradient-2: #203a43;
      --card-chip: #d4af37;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
    body { background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; display: flex; flex-direction: column; overflow-x: hidden; transition: var(--transition); padding-bottom: 80px; }

    .header { display: flex; justify-content: space-between; align-items: center; padding: 20px; position: relative; z-index: 10; }
    .logo { font-size: 24px; font-weight: 700; background: linear-gradient(90deg, var(--accent), #10b981); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

    .main-content { flex: 1; padding: 0 20px; overflow-y: auto; scrollbar-width: none; }
    .main-content::-webkit-scrollbar { display: none; }

    .section { display: none; animation: fadeIn 0.5s ease; }
    .section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .section-title { font-size: 26px; font-weight: 700; margin: 24px 0 16px; color: var(--text-primary); }

    .card { background: var(--card-bg); border-radius: var(--border-radius); padding: 20px; margin-bottom: 16px; box-shadow: var(--shadow-md); border: 1px solid var(--card-border); transition: var(--transition); }
    .card:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }

    .bank-card { background: linear-gradient(135deg, var(--card-gradient-1), var(--card-gradient-2)); border-radius: 18px; padding: 24px; margin-bottom: 24px; box-shadow: var(--shadow-lg); color: var(--card-text); position: relative; overflow: hidden; height: 200px; display: flex; flex-direction: column; justify-content: space-between; }
    .bank-card::before { content: ""; position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; border-radius: 50%; background: rgba(255, 255, 255, 0.1); }
    .bank-card::after { content: ""; position: absolute; bottom: -80px; right: -30px; width: 200px; height: 200px; border-radius: 50%; background: rgba(255, 255, 255, 0.05); }

    .bank-card-top { display: flex; justify-content: space-between; align-items: center; }
    .bank-card-logo { font-weight: 700; font-size: 20px; letter-spacing: 1px; }
    .bank-card-chip { width: 50px; height: 40px; background: var(--card-chip); border-radius: 8px; position: relative; overflow: hidden; }
    .bank-card-chip::before { content: ""; position: absolute; top: 5px; left: 5px; right: 5px; height: 10px; background: rgba(0, 0, 0, 0.1); }
    .bank-card-chip::after { content: ""; position: absolute; top: 20px; left: 5px; right: 5px; height: 10px; background: rgba(0, 0, 0, 0.1); }

    .bank-card-number { font-size: 22px; font-weight: 600; letter-spacing: 2px; margin: 15px 0; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2); }
    .bank-card-bottom { display: flex; justify-content: space-between; align-items: flex-end; }
    .bank-card-info { display: flex; flex-direction: column; }
    .bank-card-label { font-size: 10px; text-transform: uppercase; opacity: 0.8; margin-bottom: 4px; }
    .bank-card-value { font-size: 16px; font-weight: 600; }
    .bank-card-balance { font-size: 28px; font-weight: 700; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); }

    .clicker-area { display: flex; flex-direction: column; align-items: center; padding: 20px 0; }
    .tap-circle { width: 130px; height: 130px; border-radius: 50%; background: linear-gradient(145deg, var(--accent-light), rgba(79, 255, 176, 0.2)); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: var(--transition); box-shadow: var(--shadow-md); border: 3px solid var(--accent); margin: 20px 0; z-index: 2; }
    .tap-circle:active { transform: scale(0.95); }
    .tap-icon { font-size: 52px; color: var(--accent); }
    .tap-text { margin-top: 10px; font-size: 16px; color: var(--text-secondary); text-align: center; max-width: 80%; line-height: 1.5; }

    .profile-header { display: flex; flex-direction: column; align-items: center; margin-bottom: 30px; padding: 20px 0; }
    .profile-avatar { width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(45deg, var(--accent), #10b981); display: flex; align-items: center; justify-content: center; margin-bottom: 16px; font-size: 32px; font-weight: bold; color: #000; background-size: cover; background-position: center; }
    .profile-name { font-size: 22px; font-weight: 700; color: var(--text-primary); }
    .profile-level { background: var(--accent-light); color: var(--accent); padding: 4px 12px; border-radius: 50px; font-size: 13px; font-weight: 600; margin-top: 8px; }

    .stat-row { display: flex; justify-content: space-between; padding: 16px 0; border-bottom: 1px solid var(--card-border); }
    .stat-label { color: var(--text-secondary); }
    .stat-value { font-weight: 600; color: var(--text-primary); }

    .theme-toggle-container { display: flex; align-items: center; justify-content: space-between; padding: 16px 0; border-bottom: 1px solid var(--card-border); }
    .theme-toggle-label { font-size: 16px; color: var(--text-primary); }
    .theme-toggle { width: 50px; height: 26px; border-radius: 50px; background: var(--card-border); position: relative; cursor: pointer; transition: var(--transition); display: flex; align-items: center; padding: 2px; }
    .theme-toggle::after { content: ''; width: 22px; height: 22px; border-radius: 50%; background: var(--bg-primary); box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); transition: var(--transition); }
    [data-theme="dark"] .theme-toggle::after { transform: translateX(24px); }

    .bottom-nav { display: flex; justify-content: space-around; align-items: center; height: 72px; background: var(--nav-bg); backdrop-filter: blur(20px); border-top: 1px solid var(--card-border); box-shadow: var(--nav-shadow); padding: 0 10px; position: fixed; bottom: 0; left: 0; right: 0; z-index: 100; }
    .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 11px; color: var(--text-secondary); padding: 8px 0; border-radius: 14px; transition: var(--transition); width: 20%; }
    .nav-item i { font-size: 22px; margin-bottom: 4px; transition: var(--transition); }
    .nav-item.active { color: var(--accent); }
    .nav-item.active i { transform: translateY(-2px); }
    .nav-item:hover:not(.active) { color: var(--text-primary); }

    #toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(20px); background: var(--card-bg); color: var(--text-primary); padding: 12px 24px; border-radius: 50px; font-size: 14px; font-weight: 500; z-index: 1000; box-shadow: var(--shadow-lg); border: 1px solid var(--card-border); opacity: 0; transition: opacity 0.3s, transform 0.3s; }
    #toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

    @media (max-width: 480px) { .bank-card { height: 180px; padding: 20px; } .bank-card-number { font-size: 18px; } .bank-card-balance { font-size: 24px; } .tap-circle { width: 110px; height: 110px; } .tap-icon { font-size: 42px; } }
  </style>
</head>
<body>

  <div class="header">
    <div class="logo">Richman</div>
  </div>

  <div class="main-content">
    
    <div class="section active" id="home-section">
      <div class="bank-card">
        <div class="bank-card-top">
          <div class="bank-card-logo">RICHMAN</div>
          <div class="bank-card-chip"></div>
        </div>
        <div class="bank-card-number">•••• •••• •••• 1234</div>
        <div class="bank-card-bottom">
          <div class="bank-card-info">
            <div class="bank-card-label">Баланс</div>
            <div class="bank-card-balance" id="card-balance">$ 65,00</div>
          </div>
          <div class="bank-card-info">
            <div class="bank-card-label">Уровень</div>
            <div class="bank-card-value" id="card-level">1</div>
          </div>
        </div>
      </div>
      
      <div class="clicker-area">
        <div class="tap-circle" id="tap-circle">
          <i class="fas fa-hand-point-up tap-icon"></i>
        </div>
        <div class="tap-text">Кликайте, чтобы зарабатывать деньги</div>
      </div>
    </div>

    <div class="section" id="profile-section">
      <h2 class="section-title">Профиль</h2>
      
      <div class="profile-header">
        <div class="profile-avatar" id="profile-avatar"></div>
        <div class="profile-name" id="profile-name">Загрузка...</div>
        <div class="profile-level">Уровень <span id="profile-level">1</span></div>
      </div>

      <div class="card">
        <div class="stat-row">
          <span class="stat-label">Всего кликов</span>
          <span class="stat-value" id="total-clicks">0</span>
        </div>
      </div>
      
      <div class="card">
        <div class="theme-toggle-container">
          <div class="theme-toggle-label">Темная тема</div>
          <div class="theme-toggle" id="theme-toggle"></div>
        </div>
      </div>
    </div>

  </div>

  <div class="bottom-nav">
    <div class="nav-item active" data-section="home">
      <i class="fas fa-home"></i>
      <span>Главная</span>
    </div>
    <div class="nav-item" data-section="profile">
      <i class="fas fa-user"></i>
      <span>Профиль</span>
    </div>
  </div>

  <div id="toast"></div>

  <script>
    // Глобальные переменные
    let balance = 65.00;
    let clickValue = 2.50;
    let level = 1;
    let totalClicks = 0;
    let userId = null; // Будет получен от сервера
    let initData = Telegram.WebApp.initData; // Telegram initData для auth

    // DOM элементы
    const themeToggle = document.getElementById('theme-toggle');
    const htmlRoot = document.getElementById('html-root');
    const navItems = document.querySelectorAll('.nav-item');
    const sections = document.querySelectorAll('.section');
    const tapCircle = document.getElementById('tap-circle');
    const cardBalanceEl = document.getElementById('card-balance');
    const cardLevelEl = document.getElementById('card-level');
    const profileLevelEl = document.getElementById('profile-level');
    const totalClicksEl = document.getElementById('total-clicks');
    const profileAvatarEl = document.getElementById('profile-avatar');
    const profileNameEl = document.getElementById('profile-name');

    // Инициализация темы
    const savedTheme = localStorage.getItem('theme') || 'light';
    htmlRoot.setAttribute('data-theme', savedTheme);

    // Переключение темы
    themeToggle.addEventListener('click', () => {
      const currentTheme = htmlRoot.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      htmlRoot.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
    });

    // Переключение разделов
    function switchToSection(sectionId) {
      sections.forEach(section => section.classList.remove('active'));
      navItems.forEach(item => item.classList.remove('active'));
      
      document.getElementById(`${sectionId}-section`).classList.add('active');
      document.querySelector(`.nav-item[data-section="${sectionId}"]`).classList.add('active');
      
      updateUI();
      if (sectionId === 'profile') loadTelegramProfile();
    }

    navItems.forEach(item => {
      item.addEventListener('click', () => {
        const sectionId = item.getAttribute('data-section');
        switchToSection(sectionId);
      });
    });

    // Кликер
    tapCircle.addEventListener('click', () => {
      balance += clickValue;
      totalClicks++;

      // Проверка на новый уровень
      const nextLevelThreshold = level * 1000;
      if (balance >= nextLevelThreshold) {
        level++;
        clickValue = clickValue * 1.5;
        showToast(`🎉 Новый уровень! Теперь вы зарабатываете $${clickValue.toFixed(2)} за клик`);
      }

      updateUI();

      tapCircle.animate([
        { transform: 'scale(1)' },
        { transform: 'scale(0.95)' },
        { transform: 'scale(1)' }
      ], { duration: 200, easing: 'ease-out' });
    });

    // Обновление UI
    function updateUI() {
      const formattedBalance = '$ ' + balance.toFixed(2).replace('.', ',');
      cardBalanceEl.textContent = formattedBalance;
      cardLevelEl.textContent = level;
      profileLevelEl.textContent = level;
      totalClicksEl.textContent = totalClicks;
    }

    // Toast уведомления
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // Загрузка профиля из Telegram
    function loadTelegramProfile() {
      const user = Telegram.WebApp.initDataUnsafe.user;
      if (user) {
        profileNameEl.textContent = user.username || user.first_name || 'User';
        if (user.photo_url) {
          profileAvatarEl.style.backgroundImage = `url(${user.photo_url})`;
          profileAvatarEl.textContent = '';
        } else {
          profileAvatarEl.textContent = (user.first_name || 'U')[0].toUpperCase();
        }
      } else {
        profileNameEl.textContent = 'Telegram User';
      }
    }

    // Получение/создание пользователя с сервера и синхронизация баланса
    async function initUser() {
      try {
        const response = await fetch('https://dinod.ru/api/user', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ initData })
        });
        const data = await response.json();
        if (data.success) {
          userId = data.user.id;
          balance = data.user.balance; // Загрузка баланса с сервера
          updateUI();
        }
      } catch (err) {
        showToast('Ошибка соединения с сервером');
      }
    }

    // Отправка баланса каждые 30 секунд
    setInterval(async () => {
      if (userId) {
        try {
          await fetch('https://dinod.ru/api/update_balance', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ user_id: userId, balance, initData })
          });
        } catch (err) {
          console.error('Ошибка отправки баланса');
        }
      }
    }, 30000);

    // Инициализация
    Telegram.WebApp.ready();
    initUser();
    updateUI();
  </script>

</body>
</html>
